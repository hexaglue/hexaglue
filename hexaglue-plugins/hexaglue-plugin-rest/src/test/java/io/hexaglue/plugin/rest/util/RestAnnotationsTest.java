/*
 * This Source Code Form is part of the HexaGlue project.
 * Copyright (c) 2026 Scalastic
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 *
 * Commercial licensing options are available for organizations wishing
 * to use HexaGlue under terms different from the MPL 2.0.
 * Contact: info@hexaglue.io
 */

package io.hexaglue.plugin.rest.util;

import static org.assertj.core.api.Assertions.assertThat;

import com.palantir.javapoet.AnnotationSpec;
import io.hexaglue.plugin.rest.model.HttpMethod;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Nested;
import org.junit.jupiter.api.Test;

/**
 * Tests for {@link RestAnnotations}.
 */
@DisplayName("RestAnnotations")
class RestAnnotationsTest {

    @Nested
    @DisplayName("Generated Annotation")
    class GeneratedAnnotation {

        @Test
        @DisplayName("should have value and comments")
        void shouldHaveValueAndComments() {
            AnnotationSpec spec = RestAnnotations.generated();
            String code = spec.toString();
            assertThat(code).contains("io.hexaglue.plugin.rest");
            assertThat(code).contains("Generated by HexaGlue REST Plugin");
        }
    }

    @Nested
    @DisplayName("Spring Web Annotations")
    class SpringWebAnnotations {

        @Test
        @DisplayName("should create @RestController")
        void shouldCreateRestController() {
            AnnotationSpec spec = RestAnnotations.restController();
            assertThat(spec.type().toString()).isEqualTo("org.springframework.web.bind.annotation.RestController");
        }

        @Test
        @DisplayName("should create @RequestMapping with path")
        void shouldCreateRequestMapping() {
            AnnotationSpec spec = RestAnnotations.requestMapping("/api/accounts");
            String code = spec.toString();
            assertThat(code).contains("/api/accounts");
        }

        @Test
        @DisplayName("should create @GetMapping with path")
        void shouldCreateGetMapping() {
            AnnotationSpec spec = RestAnnotations.httpMethodMapping(HttpMethod.GET, "/{id}");
            String code = spec.toString();
            assertThat(code).contains("GetMapping");
            assertThat(code).contains("/{id}");
        }

        @Test
        @DisplayName("should create @PostMapping without path")
        void shouldCreatePostMappingNoPath() {
            AnnotationSpec spec = RestAnnotations.httpMethodMapping(HttpMethod.POST, "");
            String code = spec.toString();
            assertThat(code).contains("PostMapping");
            assertThat(code).doesNotContain("value");
        }
    }

    @Nested
    @DisplayName("OpenAPI Annotations")
    class OpenApiAnnotations {

        @Test
        @DisplayName("should create @Tag")
        void shouldCreateTag() {
            AnnotationSpec spec = RestAnnotations.tag("Accounts", "Account management operations");
            String code = spec.toString();
            assertThat(code).contains("Accounts");
            assertThat(code).contains("Account management operations");
        }

        @Test
        @DisplayName("should create @Operation")
        void shouldCreateOperation() {
            AnnotationSpec spec = RestAnnotations.operation("Open a new account");
            String code = spec.toString();
            assertThat(code).contains("Open a new account");
        }

        @Test
        @DisplayName("should create @ApiResponse")
        void shouldCreateApiResponse() {
            AnnotationSpec spec = RestAnnotations.apiResponse("201", "Account created successfully");
            String code = spec.toString();
            assertThat(code).contains("201");
            assertThat(code).contains("Account created successfully");
        }
    }

    @Nested
    @DisplayName("Bean Validation")
    class BeanValidation {

        @Test
        @DisplayName("should create @NotNull")
        void shouldCreateNotNull() {
            AnnotationSpec spec = RestAnnotations.notNull();
            assertThat(spec.type().toString()).isEqualTo("jakarta.validation.constraints.NotNull");
        }

        @Test
        @DisplayName("should create @NotBlank")
        void shouldCreateNotBlank() {
            AnnotationSpec spec = RestAnnotations.notBlank();
            assertThat(spec.type().toString()).isEqualTo("jakarta.validation.constraints.NotBlank");
        }
    }
}
