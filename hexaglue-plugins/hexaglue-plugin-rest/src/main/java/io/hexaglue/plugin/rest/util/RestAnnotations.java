/*
 * This Source Code Form is part of the HexaGlue project.
 * Copyright (c) 2026 Scalastic
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 *
 * Commercial licensing options are available for organizations wishing
 * to use HexaGlue under terms different from the MPL 2.0.
 * Contact: info@hexaglue.io
 */

package io.hexaglue.plugin.rest.util;

import com.palantir.javapoet.AnnotationSpec;
import com.palantir.javapoet.ClassName;
import io.hexaglue.plugin.rest.model.HttpMethod;

/**
 * JavaPoet annotation builders for REST code generation.
 *
 * <p>All annotations are built using fully qualified class names to avoid
 * compile-time dependencies on Spring Web, Jakarta, or OpenAPI libraries.
 *
 * @since 3.1.0
 */
public final class RestAnnotations {

    private RestAnnotations() {
        /* prevent instantiation */
    }

    // --- Jakarta ---
    private static final ClassName GENERATED = ClassName.get("jakarta.annotation", "Generated");

    // --- Spring Web ---
    private static final ClassName REST_CONTROLLER =
            ClassName.get("org.springframework.web.bind.annotation", "RestController");
    private static final ClassName REQUEST_MAPPING =
            ClassName.get("org.springframework.web.bind.annotation", "RequestMapping");
    private static final ClassName GET_MAPPING = ClassName.get("org.springframework.web.bind.annotation", "GetMapping");
    private static final ClassName POST_MAPPING =
            ClassName.get("org.springframework.web.bind.annotation", "PostMapping");
    private static final ClassName PUT_MAPPING = ClassName.get("org.springframework.web.bind.annotation", "PutMapping");
    private static final ClassName DELETE_MAPPING =
            ClassName.get("org.springframework.web.bind.annotation", "DeleteMapping");
    private static final ClassName PATCH_MAPPING =
            ClassName.get("org.springframework.web.bind.annotation", "PatchMapping");
    private static final ClassName PATH_VARIABLE =
            ClassName.get("org.springframework.web.bind.annotation", "PathVariable");
    private static final ClassName REQUEST_PARAM =
            ClassName.get("org.springframework.web.bind.annotation", "RequestParam");
    private static final ClassName REQUEST_BODY =
            ClassName.get("org.springframework.web.bind.annotation", "RequestBody");
    private static final ClassName RESPONSE_STATUS =
            ClassName.get("org.springframework.web.bind.annotation", "ResponseStatus");
    private static final ClassName REST_CONTROLLER_ADVICE =
            ClassName.get("org.springframework.web.bind.annotation", "RestControllerAdvice");
    private static final ClassName EXCEPTION_HANDLER =
            ClassName.get("org.springframework.web.bind.annotation", "ExceptionHandler");

    /** Spring HttpStatus class reference. */
    static final ClassName HTTP_STATUS = ClassName.get("org.springframework.http", "HttpStatus");

    /** Spring ResponseEntity class reference. */
    static final ClassName RESPONSE_ENTITY = ClassName.get("org.springframework.http", "ResponseEntity");

    // --- Bean Validation ---
    private static final ClassName VALID = ClassName.get("jakarta.validation", "Valid");
    private static final ClassName NOT_NULL = ClassName.get("jakarta.validation.constraints", "NotNull");
    private static final ClassName NOT_BLANK = ClassName.get("jakarta.validation.constraints", "NotBlank");
    private static final ClassName NOT_EMPTY = ClassName.get("jakarta.validation.constraints", "NotEmpty");
    private static final ClassName POSITIVE = ClassName.get("jakarta.validation.constraints", "Positive");
    private static final ClassName EMAIL_ANNOTATION = ClassName.get("jakarta.validation.constraints", "Email");

    // --- OpenAPI / Swagger ---
    private static final ClassName TAG = ClassName.get("io.swagger.v3.oas.annotations.tags", "Tag");
    private static final ClassName OPERATION = ClassName.get("io.swagger.v3.oas.annotations", "Operation");
    private static final ClassName API_RESPONSE =
            ClassName.get("io.swagger.v3.oas.annotations.responses", "ApiResponse");

    // --- Builder methods ---

    /**
     * Builds a {@code @Generated} annotation.
     *
     * @return the annotation spec
     */
    public static AnnotationSpec generated() {
        return AnnotationSpec.builder(GENERATED)
                .addMember("value", "$S", "io.hexaglue.plugin.rest")
                .addMember("comments", "$S", "Generated by HexaGlue REST Plugin")
                .build();
    }

    /**
     * Builds a {@code @RestController} annotation.
     *
     * @return the annotation spec
     */
    public static AnnotationSpec restController() {
        return AnnotationSpec.builder(REST_CONTROLLER).build();
    }

    /**
     * Builds a {@code @RequestMapping} annotation with a path.
     *
     * @param path the base path
     * @return the annotation spec
     */
    public static AnnotationSpec requestMapping(String path) {
        return AnnotationSpec.builder(REQUEST_MAPPING)
                .addMember("value", "$S", path)
                .build();
    }

    /**
     * Builds a {@code @Tag} annotation for OpenAPI.
     *
     * @param name        the tag name
     * @param description the tag description
     * @return the annotation spec
     */
    public static AnnotationSpec tag(String name, String description) {
        return AnnotationSpec.builder(TAG)
                .addMember("name", "$S", name)
                .addMember("description", "$S", description)
                .build();
    }

    /**
     * Builds an {@code @Operation} annotation for OpenAPI.
     *
     * @param summary the operation summary
     * @return the annotation spec
     */
    public static AnnotationSpec operation(String summary) {
        return AnnotationSpec.builder(OPERATION)
                .addMember("summary", "$S", summary)
                .build();
    }

    /**
     * Builds an {@code @ApiResponse} annotation for OpenAPI.
     *
     * @param responseCode the HTTP response code
     * @param description  the response description
     * @return the annotation spec
     */
    public static AnnotationSpec apiResponse(String responseCode, String description) {
        return AnnotationSpec.builder(API_RESPONSE)
                .addMember("responseCode", "$S", responseCode)
                .addMember("description", "$S", description)
                .build();
    }

    /**
     * Builds an HTTP method mapping annotation ({@code @GetMapping}, {@code @PostMapping}, etc.).
     *
     * @param method the HTTP method
     * @param path   the path (empty string for no path)
     * @return the annotation spec
     */
    public static AnnotationSpec httpMethodMapping(HttpMethod method, String path) {
        ClassName annotation =
                switch (method) {
                    case GET -> GET_MAPPING;
                    case POST -> POST_MAPPING;
                    case PUT -> PUT_MAPPING;
                    case DELETE -> DELETE_MAPPING;
                    case PATCH -> PATCH_MAPPING;
                };
        if (path.isEmpty()) {
            return AnnotationSpec.builder(annotation).build();
        }
        return AnnotationSpec.builder(annotation).addMember("value", "$S", path).build();
    }

    /**
     * Builds a {@code @PathVariable} annotation.
     *
     * @return the annotation spec
     */
    public static AnnotationSpec pathVariable() {
        return AnnotationSpec.builder(PATH_VARIABLE).build();
    }

    /**
     * Builds a {@code @RequestParam} annotation.
     *
     * @param required whether the parameter is required
     * @return the annotation spec
     */
    public static AnnotationSpec requestParam(boolean required) {
        return AnnotationSpec.builder(REQUEST_PARAM)
                .addMember("required", "$L", required)
                .build();
    }

    /**
     * Builds a {@code @RequestBody} annotation.
     *
     * @return the annotation spec
     */
    public static AnnotationSpec requestBody() {
        return AnnotationSpec.builder(REQUEST_BODY).build();
    }

    /**
     * Builds a {@code @Valid} annotation.
     *
     * @return the annotation spec
     */
    public static AnnotationSpec valid() {
        return AnnotationSpec.builder(VALID).build();
    }

    /**
     * Builds a {@code @NotNull} annotation.
     *
     * @return the annotation spec
     */
    public static AnnotationSpec notNull() {
        return AnnotationSpec.builder(NOT_NULL).build();
    }

    /**
     * Builds a {@code @NotBlank} annotation.
     *
     * @return the annotation spec
     */
    public static AnnotationSpec notBlank() {
        return AnnotationSpec.builder(NOT_BLANK).build();
    }

    /**
     * Builds a {@code @NotEmpty} annotation.
     *
     * @return the annotation spec
     */
    public static AnnotationSpec notEmpty() {
        return AnnotationSpec.builder(NOT_EMPTY).build();
    }

    /**
     * Builds a {@code @Positive} annotation.
     *
     * @return the annotation spec
     */
    public static AnnotationSpec positive() {
        return AnnotationSpec.builder(POSITIVE).build();
    }

    /**
     * Builds an {@code @Email} annotation.
     *
     * @return the annotation spec
     */
    public static AnnotationSpec email() {
        return AnnotationSpec.builder(EMAIL_ANNOTATION).build();
    }

    /**
     * Builds an {@code @ExceptionHandler} annotation.
     *
     * @param exceptionType the exception class
     * @return the annotation spec
     */
    public static AnnotationSpec exceptionHandler(ClassName exceptionType) {
        return AnnotationSpec.builder(EXCEPTION_HANDLER)
                .addMember("value", "$T.class", exceptionType)
                .build();
    }

    /**
     * Builds a {@code @ResponseStatus} annotation.
     *
     * @param statusName the HttpStatus enum constant name
     * @return the annotation spec
     */
    public static AnnotationSpec responseStatus(String statusName) {
        return AnnotationSpec.builder(RESPONSE_STATUS)
                .addMember("value", "$T.$L", HTTP_STATUS, statusName)
                .build();
    }

    /**
     * Builds a {@code @RestControllerAdvice} annotation.
     *
     * @return the annotation spec
     */
    public static AnnotationSpec restControllerAdvice() {
        return AnnotationSpec.builder(REST_CONTROLLER_ADVICE).build();
    }
}
